name: 'Install git-perf'
description: 'Install git-perf binary'
inputs:
  version:  # id of input
    description: 'Version to install'
    required: false
    default: 'latest'
runs:
  using: "composite"
  steps:
    - id: latest-version
      name: determine latest version
      uses: pozetroninc/github-action-get-latest-release@master
      with:
        repository: ${{ github.repository }}
        excludes: prerelease, draft
    - id: install
      run: |
        mkdir -p ~/.git-perf/
        pushd ~/.git-perf

        if [ "${{ runner.os }}" = "Linux" ]; then
          os="x86_64-unknown-linux-musl"
        elif [ "${{ runner.os }}" = "Darwin" ]; then
          os="x86_64-apple-darwin"
        else
          echo "Unsupported OS"
          exit 1

        if [[ "${{ inputs.version }}" == "latest" ]]; then
          version=${{ steps.latest-version.outputs.release }}
        else
          version=${{ inputs.version }}
        fi

        gitperf_url="https://github.com/kaihowl/git-perf/releases/download/${version}/gitperf-${version}-${os}.tar.gz"

        curl -L "$gitperf_url" | tar -xz --strip-components=1

        echo "$HOME/.git-perf" >> $GITHUB_PATH
      shell: bash

